<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.icia.aboard2.dao.UserRepository">
	<!-- 아이디 중복확인 -->
	<select id="idCheck" resultType="string">
		select id from users where id=#{id} and rownum=1
	</select>
	<!-- 로그인 인증 -->
	<select id="login" resultType="hashmap" parameterType="com.icia.aboard2.dto.UserDto$LoginUser">
	 	select a.authority, u.pwd pwd from users u, authorities a
		where u.id = a.id and u.id=#{id}
	</select>
	<!-- 로그인 인증 아이디확인 -->
	<select id="loginCheck" parameterType="string" resultType="string">
		select id from users where id=#{id}
	</select>
	<!-- 회원가입 -->
	<insert id="insertUser" parameterType="com.icia.aboard2.dto.UserDto$CreateUser">
		insert into users(id, pwd, irum, email, birthDay, address) 
		values(#{id}, #{pwd}, #{irum}, #{email}, #{birthDay}, #{address})
	</insert>
	<!-- 회원권한 -->
	<insert id="authorities">
		insert into authorities(id,authority)
		values(#{id}, 'ROLE_USER')
	</insert>
	<!-- 아이디 찾기 -->
	<select id="findId" resultType="string" parameterType="com.icia.aboard2.dto.UserDto$FindId">
		select id from users where irum=#{irum} and email=#{email} and rownum=1
	</select>
	<!-- 회원 정보 수정 -->
	<update id="updateUser" parameterType="com.icia.aboard2.dto.UserDto$UpdateUser">
		update users set pwd=#{pwd}, email=#{email}
		where id=#{id} and rownum=1
	</update>
	<!-- 회원 정보 -->
	<select id="information" resultType="hashmap">
		select email,irum,id from users where id=#{id} and rownum=1
	</select>
	<!-- 이메일 전달 -->
	<select id="getEmail" resultType="hashmap">
		select email realEmail,REPLACE(email,substr(email,5,3),'***') email from users where id=#{id} and rownum=1
	</select>
	<!-- 비밀번호 리셋 -->
	<update id="pwdReset" parameterType="com.icia.aboard2.dto.UserDto$PwdReset">
		update users set pwd=#{pwd} where id=#{id} and rownum = 1
	</update>
	<!-- 회원 권한확인 -->
	<select id="authoritySearch" resultType="string" parameterType="string">
		select authority from authorities where id = #{id}
	</select>
	<!-- 알림 확인 -->
	<select id="notice" resultType="com.icia.aboard2.dto.ReplyDto$NoticeReply" parameterType="string">
		select*from notice where notice_id=#{id}
	</select>
</mapper>





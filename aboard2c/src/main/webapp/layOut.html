<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<link rel="stylesheet" href="css/layOut.css">
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.7.2/angular-route.js"></script>
</head>
<body>
<div id="frame" ng-app="myApp">
<!-- header에 angular.bootstrap을 이용해 app두개를 생성할 수 있게되었다. -->
<header>
	<ul class="nav justify-content-end">
		<li class="nav-item"><a class="nav-link" href="#!/users/register">회원가입</a></li>
		<li class="nav-item"><a class="nav-link" href="/member/login">로그인</a></li>
		</ul>
		
</header>
<!-- 라우터 적용 부분 -->
<nav>
<ul class="shadow-lg p-3 mb-5 bg-dark nav justify-content-center">
  <li class="nav-item" style="margin: 0 auto;">
    <a class="text-white nav-link active" href="#!1">메인</a>
  </li>
  <li class="nav-item" style="margin: 0 auto;">
    <a class="text-white nav-link" href="#!2">REST</a>
  </li>
  <li class="nav-item" style="margin: 0 auto;">
    <a class="text-white nav-link" href="#!3">유저정보</a>
  </li>
  <li class="nav-item" style="margin: 0 auto;">
    <a class="text-white nav-link" href="#!boards/list/1">게시판</a>
  </li>
</ul>
</nav>
<!-- template으로 이뤄진 페이지를 view안에서 보여준다. -->
<div class="main" ng-view></div>
<!-- Footer 부분 -->
<footer>
<p>4</p>
</footer>
</div>
<script>


<!-- 라우트 script -->
// 라우트를 사용하여 템플릿을 지정해 줄 수 있다.


var app = angular.module("myApp",['ngRoute']);

app.config(function($routeProvider){
	$routeProvider
	.when("/1",{
		templateUrl:"1.html"
	})
	.when("/2",{
		templateUrl:"2.html"
	})
	.when("/3",{
		templateUrl:"3.html"
	})
	.when("/boards/list/:page",{
		// 게시판리스트
		templateUrl:"4.html",
		controller:'boardsCtrl'
	})	
	.when("/boards/read/:bno",{
		// 게시판 상세내용 
		templateUrl:"5.html",
		controller:'boardsReadCtrl'
	})
	.when("/boards/writePage",{
		// 게시판 글쓰기페이지
		templateUrl:"6.html",
		controller:'boardsWriteCtrl'
	})
	.when("/users/register",{
		// 회원가입 페이지
		templateUrl:"register.html",
		controller:"registerCtrl"
	});
	
});


// boards 리스트를 REST방식으로 page값을 넘긴후 데이터를 가져와서 boardsList에 담는다.
app.controller('boardsCtrl',function($scope, $http,$routeParams){
	var page = $routeParams.page;
	 $http.get("/aboard2/boards/list/"+page).then(function(response){
			$scope.boardsList = JSON.parse(response.data.records);
		});
	 
  });
// routeParams로 Query의 값을 받을 수 있다.
// 그 값을 GET 방식 Ajax비동기 통신으로 전달해서 resp변수에 값을 저장한다.
app.controller('boardsReadCtrl',function($scope,$http,$routeParams){
	
	var bno = $routeParams.bno;
	// 댓글 리스트를 보여주는 함수작성.
	function replyList(){$http.get("/aboard2/boards/reply/list?bno="+bno)
		.then(function(response){
			$scope.list = response.data.list;
			
		});
		};
	// 글을 읽을 때 댓글리스트를 보여주는 함수 실행.
	$http.get("/aboard2/boards/read/"+bno)
	.then(function(response){
		replyList();
		$scope.resp = response.data;
	});
	
	// ng-click 시 작동 되는 함수이다.
	// myFuc으로 reply 라는 Object를 컨트롤러에 값을 넘겨준다
	$scope.myFuc=function(){
		var data = {"replytext":$scope.rText,"bno":bno,"id":"service"};
		$http({
		url : '/aboard2/boards/reply/insert',
		method : 'post',
		data: "reply="+JSON.stringify(data),
		contentType:"application/json;charset=UTF-8",
		headers : {'Content-Type': 'application/x-www-form-urlencoded'},

	}).then(function(response){
		// insert가 성공했을 때
		replyList();
		$scope.rText="";
		alert('zz');
	});
	};
});
app.config(['$qProvider', function ($qProvider) {
    $qProvider.errorOnUnhandledRejections(false);
}]);
//Input에서 ng-model을 사용했을때 한글 dataBinding을 해주는 directive
app.directive('krInput', [ '$parse', function($parse) { return { priority : 2, restrict : 'A', compile : function(element) { element.on('compositionstart', function(e) { e.stopImmediatePropagation(); }); }, }; } ]);

</script>
</body>
</html>
